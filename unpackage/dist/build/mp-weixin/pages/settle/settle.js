(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/settle/settle"],{"0f13":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}));var o={addressItem:function(){return n.e("components/address-item/address-item").then(n.bind(null,"3032"))},goodsItem:function(){return n.e("components/goods-item/goods-item").then(n.bind(null,"a2c6"))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"39de"))},uniPopup:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-popup/components/uni-popup/uni-popup")]).then(n.bind(null,"5055"))}},r=function(){var e=this,t=e.$createElement;e._self._c},s=[]},"13b4":function(e,t,n){"use strict";n.r(t);var o=n("37c2"),r=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=r.a},"1bd2":function(e,t,n){},"37c2":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(n("a34a")),r=n("2f62");function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return p(e)||d(e,t)||u(e,t)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){if(e){if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function d(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],o=!0,r=!1,s=void 0;try{for(var i,c=e[Symbol.iterator]();!(o=(i=c.next()).done);o=!0)if(n.push(i.value),t&&n.length===t)break}catch(u){r=!0,s=u}finally{try{o||null==c["return"]||c["return"]()}finally{if(r)throw s}}return n}}function p(e){if(Array.isArray(e))return e}function l(e,t,n,o,r,s,i){try{var c=e[s](i),u=c.value}catch(a){return void n(a)}c.done?t(u):Promise.resolve(u).then(o,r)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var s=e.apply(t,n);function i(e){l(s,o,r,i,c,"next",e)}function c(e){l(s,o,r,i,c,"throw",e)}i(void 0)}))}}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=(0,r.createNamespacedHelpers)("cart"),y=g.mapGetters,v=g.mapState,b=g.mapMutations,k=(0,r.createNamespacedHelpers)("address"),w=k.mapState,S=k.mapMutations,P={data:function(){return{addressType:1,postage:10,is_vip:"",coupon:0,coupon_id:0,user_checked_address:{},payway:"wx",paramGoods:null}},computed:m(m(m(m(m({},(0,r.mapState)("user",["userInfo"])),v(["cart_list","couponsList","gift_list"])),w(["address_list","is_public_address","default_address_id"])),y(["checkedCount","checkedGoodsAmount","checkedGoodsAmount_vip"])),{},{totalPrice:function(){return(Number(this.is_vip?this.checkedGoodsAmount_vip:this.checkedGoodsAmount)+Number(this.postage)-Number(this.coupon)).toFixed(2)}}),onLoad:function(e){console.log(this.userInfo),e&&e.goods&&(this.paramGoods=JSON.parse(e.goods),console.log("参数",this.paramGoods))},onShow:function(){var t=this;e.$http.get("user_gifts/").then((function(e){t.updateGiftList(e.data.lists),t.addGift()})),this.is_vip=JSON.parse(e.getStorageSync("userInfo")||"{}").vip_active||!1,this.checkedAddress(),this.couponChanged()},onUnload:function(){e.removeStorageSync("user_checked_address"),this.deleteGift()},methods:m(m(m(m({},S(["editCheckedAddress"])),b(["addGift","deleteGift","updateGiftList","clearCart","removeGoodsById","deleteGift"])),(0,r.mapMutations)("user",["updateUserInfo"])),{},{checkedAddress:function(){var t=this,n=e.getStorageSync("user_checked_address");n?(this.user_checked_address=JSON.parse(n),console.log(this.user_checked_address)):this.user_checked_address=this.address_list.filter((function(e){return e.address_id==t.default_address_id}))[0],this.countPosterPrice()},choosePayway:function(t){this.is_vip||"banlance"!=t?this.payway=t:e.showModal({title:"提示",content:"您还不是会员，无法使用余额支付！请先去开通后重试",cancelText:"暂不考虑",confirmText:"去开通",success:function(t){t.confirm&&e.navigateTo({url:"../../mypkg/vip/vip"})}})},payWayChange:function(e){this.choosePayway(e.detail.value)},showCouponsPopup:function(){this.$refs.popup.open("bottom")},couponChanged:function(t){var n=this;if(t){if(!(this.checkedGoodsAmount>=t.min_price))return this.coupon=0,this.coupon_id=0,e.$showMsg("商品总价小于".concat(t.min_price,"元"));this.coupon=t.price,this.coupon_id=t.coupon_id,console.log(t),this.$refs.popup.close()}else{var o=this.couponsList.filter((function(e){return e.min_price<=n.checkedGoodsAmount}));if(0==o.length)return this.coupon=0;o.forEach((function(e,t){e.price>n.coupon&&(n.coupon=e.price,n.coupon_id=e.coupon_id)}))}},onSubmit:function(){var t=this;if(!this.user_checked_address||!this.user_checked_address.address_id)return e.$showMsg("请选择收货地址！");var n=[];this.cart_list.filter((function(e){return e.is_checked})).forEach((function(e){n.push({id:Number(e.goods_id),price:e.price,market_price:e.market_price,num:e.goods_count,total_price:(t.is_vip?e.market_price:e.price)*e.goods_count})}));var o={address_id:this.user_checked_address.address_id,coupon_price:this.coupon,type:this.coupon_id,posterPrice:this.postage,user_id:e.getStorageSync("id"),parent_id:e.getStorageSync("parent_id"),goods_list:n};"wx"==this.payway?this.payWX(o):"banlance"==this.payway&&this.payBanlance(o)},payWX:function(t){var n=this;return f(o.default.mark((function r(){var s,c,u,a,d,p,l,f,h,m;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,e.$http.post("wx_order/",t);case 2:return s=o.sent,c=s.data,o.next=6,e.$http.get("wx_payment/"+c.order_id+"/");case 6:return u=o.sent,a=u.data.params,o.next=10,e.requestPayment({timeStamp:String(a.timeStamp),nonceStr:a.nonceStr,package:"prepay_id="+a.prepay_id,signType:"MD5",paySign:a.sign});case 10:return d=o.sent,p=i(d,2),l=p[0],f=p[1],console.log("微信支付结果",l,f),o.next=17,e.$http.get("wxeck_order/"+c.order_id+"/");case 17:h=o.sent,m=h.data,e.$showMsg(m.msg),200===m.code?setTimeout((function(){n.deletbuyedGoods(t.goods_list),e.redirectTo({url:"../../subpkg/orders/orders?index=1"})}),1500):400===m.code&&setTimeout((function(){n.deletbuyedGoods(t.goods_list),e.redirectTo({url:"../../subpkg/orders/orders?index=0"})}),1500);case 21:case"end":return o.stop()}}),r)})))()},payBanlance:function(t){var n=this;return f(o.default.mark((function r(){var s,i,c;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,e.$http.post("mini_balance_payment/",t);case 2:s=o.sent,i=s.data,200===i.code?(e.$showMsg(i.msg),c=n.userInfo,c.money_vip-=n.totalPrice,console.log(c),n.updateUserInfo(c),setTimeout((function(){n.deletbuyedGoods(t.goods_list),e.redirectTo({url:"../../subpkg/orders/orders?index=1"})}),1500)):400===i.code&&e.$showMsg(i.msg);case 5:case"end":return o.stop()}}),r)})))()},handlePaySuccess:function(t){var n=this;e.$showMsg("支付成功"),setTimeout((function(){n.deletbuyedGoods(t),e.redirectTo({url:"../../subpkg/orders/orders?index=1"})}),1500)},handlePayFail:function(t){var n=this;e.$showMsg("支付失败，请去订单页重新支付"),setTimeout((function(){n.deletbuyedGoods(t),e.redirectTo({url:"../../subpkg/orders/orders?index=0"})}),1500)},deletbuyedGoods:function(e){var t=this;e.forEach((function(e){t.removeGoodsById(e.id)}))},countPosterPrice:function(){console.log(this.cart_list.filter((function(e){return e.is_checked})));var e=this.user_checked_address.address[0].value-0,t=[65e4,54e4],n=t.some((function(t){return t===e})),o=[62e4,15e4,64e4,63e4],r=o.some((function(t){return t===e})),s=[23e4,22e4,21e4,52e4,46e4,45e4,53e4],i=(s.some((function(t){return t===e})),this.cart_list.filter((function(e){return e.is_checked})).some((function(e){return 4==e.type})),this.cart_list.filter((function(e){return e.is_checked})).some((function(e){return 7==e.type||8==e.type})),0);if(n){var c=0;this.cart_list.filter((function(e){return e.is_checked})).forEach((function(e){c+=(e.weight-0)*e.goods_count})),c=Math.ceil(c),i=15*c}else{if(this.cart_list.filter((function(e){return e.is_checked})).forEach((function(e){4==e.type&&e.goods_count})),r&&15e4==e){var u=0;this.cart_list.filter((function(e){return e.is_checked})).forEach((function(e){u+=e.goods_count})),this.totalPrice<60&&u<4?(console.log(this.totalPrice),i=10):this.totalPrice-30<60&&u<4&&(1===this.payForm.coupon?i=10:this.payForm.coupon||(i=0))}}this.postage=i},gotoAddress:function(t){1===t?(e.navigateTo({url:"/mypkg/address/address?from=settle&type="+this.addressType}),this.addressType=2):(e.navigateTo({url:"/mypkg/address/address?from=settle&type="+this.addressType}),this.addressType=1)}})};t.default=P}).call(this,n("543d")["default"])},"5bda":function(e,t,n){"use strict";var o=n("1bd2"),r=n.n(o);r.a},7670:function(e,t,n){"use strict";n.r(t);var o=n("0f13"),r=n("13b4");for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);n("5bda");var i,c=n("f0c5"),u=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);t["default"]=u.exports},d705:function(e,t,n){"use strict";(function(e){n("b43d");o(n("66fd"));var t=o(n("7670"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["d705","common/runtime","common/vendor"]]]);